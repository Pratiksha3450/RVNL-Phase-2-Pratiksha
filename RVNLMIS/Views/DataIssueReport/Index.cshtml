@model RVNLMIS.Models.DataIssueReportWrapper

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>

    .pull-right {
        float: right;
    }

    .notify_count .badge {
        background-color: #ff5252;
        color: #fff;
        font-size: 10px;
        border-radius: 50%;
        text-align: center;
        border-radius: 50%;
        right: auto;
        position: absolute;
        top: 5px;
        padding: 4px;
        width: 19px;
        -webkit-animation: not-blink 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
        animation: not-blink 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    }
</style>
<style>

    .content_wrapper {
        padding: 0.5% 1.3%;
    }
    .col-1, .col-2, .col-3, .col-4, .col-5, .col-6, .col-7, .col-8, .col-9, .col-10, .col-11, .col-12, .col, .col-auto, .col-sm-1, .col-sm-2, .col-sm-3, .col-sm-4, .col-sm-5, .col-sm-6, 
    .col-sm-7, .col-sm-8, .col-sm-9, .col-sm-10, .col-sm-11, .col-sm-12, .col-sm, .col-sm-auto, .col-md-1, .col-md-2, .col-md-3, .col-md-4, .col-md-5, .col-md-6, .col-md-7, .col-md-8, 
    .col-md-9, .col-md-10, .col-md-11, .col-md-12, .col-md, .col-md-auto, .col-lg-1, .col-lg-2, .col-lg-3, .col-lg-4, .col-lg-5, .col-lg-6, .col-lg-7, .col-lg-8, .col-lg-9, .col-lg-10, 
    .col-lg-11, .col-lg-12, .col-lg, .col-lg-auto, .col-xl-1, .col-xl-2, .col-xl-3, .col-xl-4, .col-xl-5, .col-xl-6, .col-xl-7, .col-xl-8, .col-xl-9, .col-xl-10, .col-xl-11, .col-xl-12, 
    .col-xl, .col-xl-auto{

    }
    .ticket-card {
        padding-right: 0.25rem !important;
        padding-left: 0.25rem !important;
    }
    .card .card-block, .card .card-body {
        padding: 20px 20px;
    }
    button.close {
    padding: 0 1%;
    background-color: transparent !important;
    border: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
}
    .card {
        box-shadow: 0 2px 10px -1px rgba(69, 90, 100, 0.3);
        margin-bottom: 10px !important;
        transition: box-shadow 0.2s ease-in-out;
    }

    .social-card .download-icon {
        top: 0;
    }

    .col-form-label-sm-user {
        padding-top: calc(0.25rem + 1px);
        padding-bottom: calc(0.25rem + 1px);
        font-size: 12px;
        line-height: 1.5 !important;
    }

    .modal-xl {
        width: 1150px !important;
    }

    .cardp {
        margin-bottom: 0px !important;
    }

    .style-toggler {
        z-index: 1029;
        position: relative;
        text-align: center;
        color: #fff;
        padding-top: 13px;
        width: 45px;
        height: 45px;
        position: absolute;
        right: 0;
        top: 30px;
        z-index: 1001;
        background: #ff5252;
        transition: 0.3s ease-in-out;
        border-radius: 30px 0 0 30px;
        box-shadow: -4px 0 8px rgba(255, 82, 82, 0.16), -6px 0 8px rgba(0, 0, 0, 0.1);
    }
</style>

<link href="~/Content/assets/css/plugins/lightbox.min.css" rel="stylesheet" />
<link href="~/Content/assets/css/plugins/ekko-lightbox.css" rel="stylesheet" />

<div id="myModal" class="modal fade" data-backdrop="static" data- keyboard="false">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="card cardp bg-c-red text-white widget-visitor-card">
                <button type="button" class="close text-white text-right m-r-10" data-dismiss="modal" aria-hidden="true">×</button>
                <div class="card-body text-center">
                    <h2 class="text-white"> Alert</h2>
                    <h6 class="text-white">@Model.objModel.ReportMsg</h6>
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
            </div>
        </div><!--modal footer-->
    </div><!--modal content-->
</div><!--modal dialog-->


<div class="modal fade" id="UpdateStatusModel" tabindex="-1" role="dialog" aria-labelledby="UpdateStatusModel" aria-hidden="true" data-backdrop="static">
    <div id="UpdateStatusContainer" class="modal-dialog modal-xl "></div>
</div>
<div class="content_wrapper customcols">
    <div class="row">
        <div class="col-sm-3 pl-1 pr-1">
            <div class="card bg-c-yellow text-white widget-visitor-card">
                <div class="card-body text-center">
                    <h2 class="text-white">@Model.objModel.NewTicket</h2>
                    <h6 class="text-white"> @Html.ActionLink("New Ticket", "Index", "Ticket")</h6>
                    <i class="feather icon-user"></i>
                </div>
            </div>
        </div>
        <div class="col-sm-3 pl-1 pr-1">
            <div class="card bg-c-blue text-white widget-visitor-card">
                <div class="card-body text-center">
                    <h2 class="text-white">@Model.objModel.SubmitedForReview</h2>
                    <h6 class="text-white">Submited For Review</h6>
                    <i class="feather icon-file-text"></i>
                </div>
            </div>
        </div>
        <div class="col-sm-3 pl-1 pr-1">
            <div class="card bg-c-red text-white widget-visitor-card">
                <div class="card-body text-center">
                    <h2 class="text-white">@Model.objModel.ReOpened</h2>
                    <h6 class="text-white">Reopened</h6>
                    <i class="feather icon-thumbs-down f-28"></i>
                </div>
            </div>
        </div>


        <div class="col-sm-3 pl-1 pr-1">
            <div class="card bg-c-green text-white widget-visitor-card">
                <div class="card-body text-center">
                    <h2 class="text-white">@Model.objModel.Closed</h2>
                    <h6 class="text-white">Resolved and Closed</h6>
                    <i class="feather icon-award"></i>
                </div>
            </div>
        </div>

      
        @foreach (var item in Model.objList)
        {
            <div class="col-xl-4 col-md-6 pl-1 pr-1">
                <div class="card ticket-card">
                    <div class="card-body">
                        @switch (item.StatusId)
                        {
                            case 1:

                                <p class="m-b-25 badge-light-warning lbl-card"><i class="fas fa-folder-open m-r-5"></i> New Ticket</p>
                                <div class="spinner-grow spinner-grow-sm text-warning" role="status">
                                    <span class="sr-only">Loading...</span>
                                </div>
                                break;
                            case 2:
                                <p class="m-b-25 badge-light-primary lbl-card"><i class="fas fa-file-archive m-r-5"></i> Ticket Submited for review</p>
                                <div class="spinner-grow spinner-grow-sm text-info" role="status">
                                    <span class="sr-only">Loading...</span>
                                </div>
                                break;
                            case 3:

                                <p class="m-b-25 badge-light-danger lbl-card"><i class="fas fa-folder-open m-r-5"></i> Reopened Ticket</p>
                                <div class="spinner-grow spinner-grow-sm text-danger" role="status">
                                    <span class="sr-only">Loading...</span>
                                </div>
                                break;
                        }
                        <text class="dayCall float-right text-muted" title="Ticket Active since" data-value="@(Convert.ToDateTime(item.CreatedOn).ToString("yyyy-MM-dd HH:mm:ss"))"></text>
                        <div class="row">
                            <div class="col-md-6"><h5 class="m-b-0 d-inline-block text-muted" title="Issue Ticket number">@item.DataTicket</h5></div>
                            <div class="col-md-6"><p class="m-b-0 d-inline-block float-right">Created On:<span class="text-c-blue"> @(Convert.ToDateTime(item.CreatedOn).ToString("dd-MMM-yyyy"))</span></p></div>
                        </div>
                        <div class="text-center">
                            @switch (item.StatusId)
                            {
                                case 1:
                                    <h5 class="m-b-0 m-t-10 d-inline-block text-c-yellow" title="@(item.ShortDescription)">&ldquo; @item.ShortDescription &rdquo;</h5>
                                    break;
                                case 2:
                                    <h5 class="m-b-0 m-t-10 d-inline-block text-c-blue" title="@(item.ShortDescription)">&ldquo; @item.ShortDescription &rdquo;</h5>
                                    break;
                                case 3:
                                    <h5 class="m-b-0 m-t-10 d-inline-block text-c-red" title="@(item.ShortDescription)">&ldquo; @item.ShortDescription &rdquo;</h5>
                                    break;
                            }



                            <p class="m-b-0 m-t-10"><a href="#" class="getIssueById" data-url='/DataIssueReport/GetDataIssueById/@(item.IssueId)'> <i class="feather icon-chevrons-right m-r-10 f-18 text-c-red"></i>Click for Update </a></p>
                        </div>
                    </div>
                </div>
            </div>
        }

        @*@foreach (var item in Model.objList)
        {
            <div class="col-md-12 col-xl-4 ">
                <div class="card app-design">
                    <div class="card-body ">
                        <div class="col-sm-12">
                            <div class="ticket-card float-right">
                                @switch (item.StatusId)
                                {
                                    case 1:

                                        <p class="m-b-25 badge-light-warning lbl-card"><i class="fas fa-folder-open m-r-5"></i> New Ticket</p>

                                        break;
                                    case 2:
                                        <p class="m-b-25 badge-light-primary lbl-card"><i class="fas fa-file-archive m-r-5"></i> Ticket Submited for review</p>

                                        break;
                                    case 3:

                                        <p class="m-b-25 badge-light-danger lbl-card"><i class="fas fa-folder-open m-r-5"></i> Reopened Ticket</p>
                                        break;
                                }
                            </div>

                            @switch (item.StatusId)
                            {
                                case 1:
                                    <div class="spinner-grow spinner-grow-sm text-warning" role="status">
                                        <span class="sr-only">Loading...</span>
                                    </div>
                                    break;
                                case 2:
                                    <div class="spinner-grow spinner-grow-sm text-info" role="status">
                                        <span class="sr-only">Loading...</span>
                                    </div>
                                    break;
                                case 3:
                                    <div class="spinner-grow spinner-grow-sm text-danger" role="status">
                                        <span class="sr-only">Loading...</span>
                                    </div>
                                    break;
                            }
                        </div>

                        <h6 class="m-t-10 ">@item.DataTicket</h6>
                        <p class=" f-w-400">Created On:<span class="text-c-blue"> @(Convert.ToDateTime(item.CreatedOn).ToString("dd-MMM-yyyy"))</span></p>
                        <p class="text-muted f-w-400">Remark : @item.Remark</p>
                        <p class="">	&ldquo; @item.ShortDescription &rdquo;</p>
                        <div class="team-box">
                            <p class="d-inline-block m-r-20 f-w-400">Attachments</p><br />
                            <div class="team-section ">
                                <div class="row ">
                                    <div class=" col-lg-3 col-sm-4 col-xs-12">
                                        <a href="~/Uploads/DataIssues/@(item.Attachment)" data-toggle="lightbox" data-title="@(item.ShortDescription)" data-footer="@(item.ShortDescription)">
                                            <img src="~/Uploads/DataIssues/@(item.Attachment)" class="img-fluid m-b-10" alt="" width="20px">
                                        </a>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <button class="btn btn-primary float-right getIssueById" data-url='/DataIssueReport/GetDataIssueById/@(item.IssueId)'>View Detail</button>
                    </div>
                </div>

            </div>
        }*@
    </div>
</div>

@section scripts{

    <script>

        $(document).ready(function () { });
        $(window).load(function () {
            $('#myModal').modal('show');
        });
        window.setInterval(function () {
            $('.dayCall').each(function () {

                var datde = $(this).data('value');
                countDownDate = new Date(datde).getTime();
                var d = new Date($.now());
                var dd =(d.getFullYear()+"-"+(d.getMonth() + 1)+"-"+d.getDate()+" "+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds());
                var now = new Date(dd).getTime();
                //console.log("my "+datde);
                //console.log("sys "+dd);
                //console.log(new Date());
                //console.log(countDownDate);
                //console.log(now);
                // Find the distance between now and the count down date
                var distance = countDownDate - now;
                 //console.log(distance);
                // Time calculations for days, hours, minutes and seconds
                var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                days = days + 1;
                days = days * -1;
               // console.log(days);
                if (days<0) {
                    days = 0;
                }
              //  console.log(days);
                var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                var res = days + "d " + hours + "h " + minutes + "m " + seconds + "s ";
                res = res.replace(/\-/g, ' ');
                 //console.log(res);
                $(this).text(res)
            });
        }, 1000);


        $(".getIssueById").on("click", function (e) {
            e.preventDefault();
            var url = $(this).data("url");
            console.log(url);
            $.get(url, function (data) {
                console.log(data);
                $('#UpdateStatusContainer').html(data);
                $('#UpdateStatusModel').modal('show');
                setTimeout(function () {
                }, 500);
            });
        });

        function OnUpdateSuccess(data) {
            if (data == "0") {

                $.notify('Technical Error, Please try again', { align: "right", verticalAlign: "top", type: "error", background: "#ff9933", color: "#ffffff" });
            }
            else if (data == "1") {
                $('#UpdateStatusModel').modal('hide');
                $('#UpdateStatusContainer').html("");
                window.location = '/DataIssueReport/index';
                $.notify('Status Updated Successfully', { align: "right", verticalAlign: "top", type: "success", background: "#0eed73", color: "#fff" });
            }
            else if (data=="2") {
                $.notify('Please Add remark to Update Ticket', { align: "right", verticalAlign: "top", type: "warning", background: "#ff9933", color: "#ffffff" });
            }
        }
    </script>

    <script src="~/Content/assets/js/plugins/ekko-lightbox.min.js"></script>
    <script src="~/Content/assets/js/plugins/lightbox.min.js"></script>
    <script src="~/Content/assets/js/pages/ac-lightbox.js"></script>
}
<div class="style-toggler"><a href="/Packages/Index" title="Go back to Home Page">
    <i class="fa fa-home text-white"></i></a>
</div>